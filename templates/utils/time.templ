package utils

import (
	"fmt"
	"strings"
	"time"
)

func GetTime(ts ...int64) templ.JSExpression {
	t := timeFromUnix(ts...).Format("2006-01-02T15:04:05-07:00")
	return templ.JSExpression(t)
}

func HumanReadableDate(locale string, ts ...int64) string {
	t := timeFromUnix(ts...)

	months := map[string][]string{
		"en": {"Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"},
		"es": {"enero", "febrero", "marzo", "abril", "mayo", "junio", "julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"},
	}

	lang := "en"

	base, _, _ := strings.Cut(locale, "_")
	if _, ok := months[base]; ok {
		lang = base
	}

	month := months[lang][t.Month()-1]
	day := t.Day()
	year := t.Year()

	if lang == "es" {
		return fmt.Sprintf("%d de %s, %d", day, month, year)
	}

	return fmt.Sprintf("%s %d, %d", month, day, year)
}

func timeFromUnix(ts ...int64) time.Time {
	if len(ts) > 0 && ts[0] > 0 {
		return time.Unix(ts[0], 0)
	}
	return time.Now()
}
